<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template per il report dell'ordine di acquisto con supporto dichiarazioni d'intento -->
    <template id="purchase_order_report_taxes_dichiarazione_intento" 
              inherit_id="purchase.report_purchaseorder_document"
              name="Purchase Order Report - Taxes 0% Dichiarazione Intento">
        <!-- Sostituisce tax_label con invoice_label per visualizzare il codice specifico della tassa (es. 0% DICH.INT.ITA.F) -->
        <xpath expr="//span[contains(@t-out, 'tax.tax_label')]" position="replace">
            <span t-out="', '.join(tax.invoice_label for tax in line.tax_ids if tax.invoice_label)"/>
        </xpath>
        <!-- Aggiunge informazioni dichiarazione intento e note posizione fiscale dopo sezione totali -->
        <xpath expr="//div[@id='total']" position="after">
            <!-- Mostra codice e data della dichiarazione intento se collegata all'ordine -->
            <t t-if="o.dichiarazione_intento_id">
                <div class="small mt-3">
                    <strong>Dichiarazione di Intento:</strong>
                    <span t-field="o.dichiarazione_intento_code"/>
                    <t t-if="o.dichiarazione_intento_date">
                        - Data:
                        <span t-field="o.dichiarazione_intento_date" t-options="{'date_only': 'true'}"/>
                    </t>
                </div>
            </t>
            <!-- Mostra note della posizione fiscale se Ã¨ "Dichiarazione di Intento" e ha note compilate -->
            <t t-if="o.dichiarazione_intento_id and o.fiscal_position_id and o.fiscal_position_id.name in ('Dichiarazione di Intento', 'Dichiarazione d\'Intento') and o.fiscal_position_id.note">
                <div class="text-muted small mt-3">
                    <t t-out="o.fiscal_position_id.note"/>
                </div>
            </t>
        </xpath>
    </template>
</odoo>
